===== TOC (3 fichiers) =====
1. C:\MyCode\Konnaxionv14\frontend\_e2e\example.spec.ts
2. C:\MyCode\Konnaxionv14\frontend\tests\routes-tests.spec.ts
3. C:\MyCode\Konnaxionv14\frontend\tests\routes.spec.ts
===== END TOC =====


===== BEGIN _e2e/example.spec.ts =====
import { expect, test } from "@playwright/test"

test("has title", async ({ page }) => {
  await page.goto("./")

  await expect(page).toHaveTitle(/Next.js Enterprise Boilerplate/)
})

===== END _e2e/example.spec.ts =====


===== BEGIN tests/routes-tests.spec.ts =====
'use client'

import { test } from '@playwright/test'
import fs from 'fs'
import path from 'path'

const routes: string[] = JSON.parse(fs.readFileSync('routes-tests.json', 'utf8'))
const outDir = path.join('playwright-report', 'index-test')
const NAV_TMO = Number(process.env.NAV_TMO ?? 45_000)
const toSafe = (s: string) => s.replace(/[^a-z0-9-_]+/gi, '_')

fs.mkdirSync(outDir, { recursive: true })

test.describe('Smoke pages index.test (collect errors)', () => {
  for (const r of routes) {
    test(`GET ${r}`, async ({ page }) => {
      page.setDefaultNavigationTimeout(NAV_TMO)
      let resp: any = null
      try {
        resp = await page.goto(`http://localhost:3000${r}`, { waitUntil: 'domcontentloaded', timeout: NAV_TMO })
      } catch {}

      const bodyText = await page.evaluate(() => document.body?.innerText || '')
      const modNotFound = bodyText.match(/Module not found:.*resolve.*\n?.*/i)?.[0] ?? null
      const buildErr = /Build Error/i.test(bodyText)
      const status = resp?.status?.()

      const base = toSafe(r)
      try { await page.screenshot({ path: path.join(outDir, `${base}.png`), fullPage: true }) } catch {}
      fs.writeFileSync(path.join(outDir, `${base}.html`), await page.content(), 'utf8')
      fs.appendFileSync(path.join(outDir, 'summary.ndjson'),
        JSON.stringify({ route: r, status, buildErr, modNotFound }) + '\n'
      )
    })
  }
})

===== END tests/routes-tests.spec.ts =====


===== BEGIN tests/routes.spec.ts =====
import { test, expect } from '@playwright/test'
import fs from 'fs'
import path from 'path'

const routes: string[] = JSON.parse(fs.readFileSync('routes.json', 'utf8'))
const GATE = process.env.SMOKE_GATE === '1'
const NAV_TMO = Number(process.env.NAV_TMO ?? 45_000)
const outDir = 'playwright-report'
const toSafe = (s: string) => s.replace(/[^a-z0-9-_]+/gi, '_')

test.describe('Smoke all pages', () => {
  for (const p of routes) {
    test(`GET ${p}`, async ({ page }) => {
      page.setDefaultTimeout(NAV_TMO)
      page.setDefaultNavigationTimeout(NAV_TMO)

      const logs: { type: string; text: string }[] = []
      page.on('console', m => logs.push({ type: m.type(), text: m.text() }))
      page.on('pageerror', e => logs.push({ type: 'pageerror', text: String(e) }))

      let resp: any = null
      let navErr: string | null = null
      try {
        resp = await page.goto(`http://localhost:3000${p}`, { waitUntil: 'domcontentloaded', timeout: NAV_TMO })
      } catch (e: any) {
        navErr = String(e?.message ?? e)
      }
      const status = resp?.status()
      const ok = !!resp?.ok()

      const severe = logs.filter(l =>
        ['error', 'assert', 'pageerror'].includes(l.type) && !/favicon\.ico/i.test(l.text)
      )

      fs.mkdirSync(outDir, { recursive: true })
      if (navErr || !ok || severe.length) {
        const base = toSafe(p)
        try { await page.screenshot({ path: path.join(outDir, `smoke_${base}.png`), fullPage: true }) } catch {}
      }
      fs.appendFileSync(path.join(outDir, 'smoke.ndjson'),
        JSON.stringify({ path: p, status, ok, navErr, severe }) + '\n'
      )

      if (GATE) {
        expect(ok, `HTTP ${status} on ${p}`).toBeTruthy()
        expect(severe, `client errors on ${p}`).toHaveLength(0)
      }
    })
  }
})

===== END tests/routes.spec.ts =====

