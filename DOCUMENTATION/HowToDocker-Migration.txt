1. What migration files are (in your project)

---

In Django (which your Konnaxion stack is based on), a *migration* is a small Python file that describes a change to the database schema:

* They live in each app’s `migrations/` folder, e.g.
  `konnaxion/some_app/migrations/0001_initial.py`, `0002_add_field.py`, etc.
* Each migration says things like “create this table”, “add this column”, “rename this field”, …
* Django keeps track of which migrations have been applied in a special table (`django_migrations`) in your database.
* You normally do **not** edit old migrations in place. You:

  * change your models (`models.py`)
  * run `makemigrations` to generate new migration files
  * run `migrate` to apply them to the database

2. How to “update” after you changed migrations

---

This depends on whether you:

* changed models and want new migrations, or
* manually edited existing migration files.

I’ll cover both, using your Docker setup.

### A. You changed models and want new migrations (recommended workflow)

**Local (docker-compose.local.yml)**

From the project root:

```bash
# 1. Generate migrations from model changes
docker compose -f docker-compose.local.yml run --rm django python manage.py makemigrations

# 2. Apply them to your local database
docker compose -f docker-compose.local.yml run --rm django python manage.py migrate
```

Then restart Django if needed:

```bash
docker compose -f docker-compose.local.yml restart django
```

**Production (docker-compose.production.yml)**

You normally:

1. Generate migrations locally (as above), commit them to git.
2. Deploy / rebuild production images.
3. Run migrations on the server:

```bash
docker compose -f docker-compose.production.yml run --rm django python manage.py migrate
```

After that, restart your services if they’re not already restarted as part of your deploy.

### B. You manually edited existing migration files

If you simply tweaked a migration file (for example, fixed a typo in `RunPython`, or adjusted an operation) and the database is not yet migrated past that point, then:

* You do **not** run `makemigrations` again.
* You just run `migrate` so Django replays or continues migrations:

Local:

```bash
docker compose -f docker-compose.local.yml run --rm django python manage.py migrate
```

Production:

```bash
docker compose -f docker-compose.production.yml run --rm django python manage.py migrate
```

Important cautions:

* If the migration was already applied to a database, changing it can cause mismatches between DB and code. In that case, the safer pattern is:

  * leave the old migration as-is
  * create a **new** migration that fixes things (e.g. another `AlterField`, `RunPython`, etc.)

3. Do you need to rebuild Docker images for migration changes?

---

* **Local dev**: your `django` container mounts the code (`.:/app`), so updating migrations on disk is enough. You usually do **not** need to rebuild; just run `migrate` (and maybe restart the container).
* **Production**: migrations live inside the image. If you changed migration files in the codebase, you must:

  1. rebuild the image (`up -d --build django` as we discussed earlier),
  2. then run `docker compose -f docker-compose.production.yml run --rm django python manage.py migrate`.

If you tell me exactly what you changed (new migration vs edited old one), I can give you a short set of “do exactly these 2–3 commands” for your situation.
